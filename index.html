<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />
  <title>ChatGPT</title>
  <link rel="stylesheet" href="index.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/split.js/1.6.0/split.min.js"></script>
</head>

<body class="myarrow">
  <div class="flex">
    <div id="one" class="split page darwin">
      <webview id="webviewOAI" src="https://chat.openai.com/chat" autosize="on">
      </webview>
    </div>
      <div id="two" class="split page darwin">
      <webview id="webviewBARD" src="https://bard.google.com" autosize="on">
      </webview>
    </div>
    <div id="three" class="split page darwin">
      <webview id="webviewCLAUDE" src="https://console.anthropic.com/chat/new" autosize="on">
      </webview>
    </div>
  </div>
  <form id="form" class="">
    <!-- we tried switching this to a textarea but the UX suffered from the lack of hitting enter to send  -->
    <input rows="4" style="background-color:bisque" id="prompt" type="text" name="prompt"
      placeholder="enter a superprompt here (you can Cmd+1/2/3/A to resize windows)"></input><button id="btn" type="submit">submit</button>
  </form>
  <script>
    const webviewOAI = document.getElementById('webviewOAI');
    const webviewBARD = document.getElementById('webviewBARD');
    const webviewCLAUDE = document.getElementById('webviewCLAUDE');
    // add event listener for btn
    const promptEl = document.getElementById('prompt');
    promptEl.addEventListener('input', function (event) {
      // get prompt from input
      const xxx = promptEl.value.replace(/"/g, '\\"') // sanitize or ele will break the insertion below
      webviewBARD.executeJavaScript(`
      var inputElement = document.querySelector("#mat-input-0");

      // try to send keyboard event to trigger the re-enable of the disabled button
      // thanks chatgpt!
      var event = new Event('input', { bubbles: true });
      event.simulated = true;
      var tracker = inputElement._valueTracker;
      if (tracker) {
        tracker.setValue("${xxx}");
      }
      // Dispatch the event after a short delay to fix the button state
      setTimeout(function() {
        inputElement.dispatchEvent(event);
      }, 100);
        inputElement.value = "${xxx}"`)
      webviewOAI.executeJavaScript(`
      var inputElement = document.querySelector('textarea[placeholder="Send a message."]')
      inputElement.value = "${xxx}"`)
      webviewCLAUDE.executeJavaScript(`
      var inputElement = document.querySelector('div.ProseMirror')
      inputElement.innerHTML = "${xxx}"`)
    })
    const form = document.getElementById('form');
    form.addEventListener('submit', function (event) {
      const xxx = promptEl.value.replace(/"/g, '\\"')
      event.preventDefault();
      // get prompt from input
      // const xxx = promptEl.value
      webviewBARD.executeJavaScript(`
      var inputElement = document.querySelector("#mat-input-0");

      // try to send keyboard event to trigger the re-enable of the disabled button
      // thanks chatgpt!
      var event = new Event('input', { bubbles: true });
      event.simulated = true;
      var tracker = inputElement._valueTracker;
      if (tracker) {
        tracker.setValue("${xxx}");
      }
      inputElement.dispatchEvent(event);
      inputElement.value = "${xxx}"
      var btn = document.querySelector("button[aria-label='Send message']");
      btn.setAttribute("aria-disabled", "false"); // doesnt work alone
      btn.click()`)
      webviewOAI.executeJavaScript(`
      var btn = document.querySelector("textarea[placeholder='Send a message.']+button");
      btn.disabled = false;
      btn.click()`)
      webviewCLAUDE.executeJavaScript(`
      var btn = document.querySelector('div.group.flex.p-3 button:has(svg)'); // YES we are using the has selector!!!!
      btn.disabled = false;
      btn.click()`)
    })

    // fix the styling of each chat
    webviewBARD.addEventListener('dom-ready', function () {
      // hide message below text input, sidebar, suggestions on new chat
      webviewBARD.insertCSS(`
        .chat-history, .conversation-container, .input-area, .mdc-text-area {
          margin: 0 !important;
        }
        /* hide the bard greeting */
        response-container {
              display: none;
        }
        model-response response-container {
              display: block !important;
        }
        /* hide header and footer */
        .gmat-caption {
          opacity: 0;
          height: 0;
        }
        header {
          display: none !important;
        }
        header + div {
          display: none !important;
        }
        .capabilities-disclaimer {
          display: none !important;
        }
        .input-area-container .input-area {
          padding: 0;
        }
        /* hide the bard avatar in response */
        .logo-gutter {
          display: none !important;
        }
      `)
    })
    webviewOAI.addEventListener('dom-ready', function () {

      // hide message below text input, sidebar, suggestions on new chat
      webviewOAI.insertCSS(`
        .text-xs.text-center {
          opacity: 0;
          height: 0;
          margin-bottom: -10px;
        }
        
        .sticky,
        .pointer-events-auto.flex.border-orange-500,
        [class*="shared__Capabilities"] {
          display: none !important;
        }

        [class*="shared__Wrapper"] {
          align-items: center;
          justify-content: center;
          text-align: center;
          margin-top: 15vh;
        }

        [class*="shared__Wrapper"] h3 {
          margin-top: -40px;
          font-size: 20px;
        }

        .flex-shrink-0.flex.flex-col.relative.items-end {
          display: none !important;
        }

      `)

      // const element = webviewOAI.executeJavaScript(`
      //  document.querySelector("[class*='shared__Wrapper']").innerHTML += "<h3>Start by asking anything.</h3>"
      // `);
    });
    webviewCLAUDE.addEventListener('dom-ready', function () {

      // hide message below text input, sidebar, suggestions on new chat
      setTimeout(() => {
        webviewCLAUDE.insertCSS(`
        header, .container {
          background-color: white;
          /* single line dark mode ftw */
          filter: invert(100%) hue-rotate(180deg);
        }
        /* hide the claude avatar in response */
        .p-1.w-9.h-9.shrink-0 {
          display: none;
        }
        /* reduce claude prompt margins */
        .mx-4.md\:mx-12.mb-2.md\:mb-4.mt-2.w-auto {
          margin: 0 !important;
        }
        `)
      }, 1000)

      // const element = webviewOAI.executeJavaScript(`
      //  document.querySelector("[class*='shared__Wrapper']").innerHTML += "<h3>Start by asking anything.</h3>"
      // `);
    });

      const splitInstance = Split(["#one", "#two", "#three"], {
        direction: "horizontal",
        minSize: 0,
      });

      document.addEventListener("keydown", (event) => {
        if (event.defaultPrevented) {
          return;
        }

        const isCmdOrCtrl = event.metaKey || event.ctrlKey;

        if (isCmdOrCtrl) {
          switch (event.key) {
            case "1":
              splitInstance.setSizes([100, 0, 0]);
              event.preventDefault();
              break;
            case "2":
              splitInstance.setSizes([0, 100, 0]);
              event.preventDefault();
              break;
            case "3":
              splitInstance.setSizes([0, 0, 100]);
              event.preventDefault();
              break;
            case "a":
            case "A":
              splitInstance.setSizes([33.33, 33.33, 33.33]);
              event.preventDefault();
              break;
            default:
              return;
          }
        }
      });
  </script>
</body>

</html>